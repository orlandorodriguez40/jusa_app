name: Flutter iOS Build

on:
  push:
    branches:
      - main
    tags:
      - 'v*'
  workflow_dispatch:

jobs:
  build-ios:
    runs-on: macos-latest  # ğŸ‘ˆ usamos macOS runner

    permissions:
      contents: write
      actions: write

    env:
      FLUTTER_VERSION: '3.22.0' # ğŸ‘ˆ ajusta a tu versiÃ³n local

    steps:
      # ===============================
      # ğŸ“¥ Checkout del repositorio
      # ===============================
      - name: Checkout repository
        uses: actions/checkout@v4

      # ===============================
      # âš™ï¸ Configurar Flutter
      # ===============================
      - name: Setup Flutter
        uses: subosito/flutter-action@v2
        with:
          flutter-version: ${{ env.FLUTTER_VERSION }}

      # ===============================
      # ğŸ“¦ Instalar dependencias
      # ===============================
      - name: Install dependencies
        run: flutter pub get

      # ===============================
      # ğŸ§¹ Clean & Build iOS
      # ===============================
      - name: Flutter clean
        run: flutter clean

      - name: Build iOS
        run: flutter build ios --no-codesign
        # ğŸ‘† genera el proyecto listo para Xcode, sin firmar

      # ===============================
      # ğŸ“¤ Upload Artifacts
      # ===============================
      - name: Upload iOS build
        uses: actions/upload-artifact@v4
        with:
          name: ios-build
          path: build/ios/iphoneos/
